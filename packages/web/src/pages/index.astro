---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Welcome to Astro.">
  <main>
    <h1 id="greeting">Welcome!</h1>
    <!-- style the input using tailwind css with a gray border and a ring on focus -->
    <input
      type="text"
      name="name"
      class="border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 h-8"
    />
    <button
      id="btn"
      class="border-2 border-black rounded-md py-2 px-4 bg-slate-500/20 disabled:bg-blue-500/50"
    >
      Click Me
    </button>
  </main>
</Layout>

<script>
  import type { PostCreateOutput } from "../../../core/src/trpc/config/router";
  import { trpcClient } from "../lib/trpc";

  const greeting = document.getElementById("greeting")!;

  const btn = document.getElementById("btn") as HTMLButtonElement;
  btn.onclick = async () => {
    // capture the text in the input element and check that it is not blank, if it is blank alert invalid input
    const name = document.querySelector("input[name=name]") as HTMLInputElement;

    if (name.value === "") {
      alert("Invalid input");
      return;
    }

    console.log("fetching...");
    btn.disabled = true;
    btn.innerHTML = "Loading...";
    const [resp] = await trpcClient.createRecord.mutate();
    console.log("fetch complete.");
    btn.disabled = false;
    btn.innerHTML = "Click Me";
    greeting.innerHTML = resp.fullName;
  };
</script>
